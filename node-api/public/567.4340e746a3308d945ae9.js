(self.webpackChunkangular=self.webpackChunkangular||[]).push([[567],{8567:(e,t,o)=>{"use strict";o.r(t),o.d(t,{ResourcesModule:()=>N});var s=o(6090),i=o(5551),r=o(8525),a=o(6633),n=o(2340);class l extends a.HA{constructor(){super(...arguments),this.resources=5,this.months=3,this.type=n.N.calculationType.resources,this.rateOffered=0,this.finalPriceWithDiscount=0,this.timeIndex=0,this.totalMonthlyCost=0,this.totalProjectCost=0,this.totalCost=0,this.totalHours=0}}var c=o(793),u=o(9866),d=o(9699),g=o(2057),h=o(3738),p=o(6097),f=o(5484),m=o(337),Z=o(643),v=o(6355),M=o(2443);const I=["hourlyTemplate"],y=["saveCalculationModal"],T=["estimatorPdfModal"];function b(e,t){if(1&e&&(c.TgZ(0,"option",50),c._uU(1),c.qZA()),2&e){const e=t.$implicit;c.Q6J("ngValue",e._id),c.xp6(1),c.hij(" ",e.countryName," ")}}function x(e,t){if(1&e&&(c.TgZ(0,"option",51),c._uU(1),c.qZA()),2&e){const e=t.$implicit;c.Q6J("value",e._id),c.xp6(1),c.hij(" ",e.serviceName," ")}}const A=function(){return{backdrop:"static",keyboard:!1,animated:!0}},C=function(){return{isAnimated:!0,dateInputFormat:"DD/MM/YYYY",showWeekNumbers:!1,adaptivePosition:!0}};let q=(()=>{class e{constructor(e,t,o,s,r,n,c,u,d,g,h){this.activatedRoute=e,this.router=t,this.savedProposalService=o,this.manageService=s,this.subRegionsService=r,this.regionsService=n,this.jwtService=c,this.alertService=u,this.spinner=d,this.toastr=g,this.globalService=h,this.title="Resources Calculation | Estimation Calculator",this.resourceInfo=new l,this.manageServicesList=[],this.subRegionsList=[],this.hourlyWiseConfig={},this.requiredValidation=new a.NZ,this.optionsResources={floor:1,ceil:20,autoHideLimitLabels:!0,showSelectionBar:!0},this.optionsMonthly={floor:1,ceil:12,autoHideLimitLabels:!0,showSelectionBar:!0},this.saveCalculationModal=i.oB,this.estimatorPdfModal=i.oB,this.DateRange={minDate:new Date,maxDate:new Date},this.DateRange.minDate.setDate(this.DateRange.minDate.getDate()),this.DateRange.maxDate.setDate(this.DateRange.minDate.getDate()+20),this.getManageServicesList(),this.getSubRegionsList();let p=this.activatedRoute.snapshot.params.id;p&&(this.resourceInfoIdData(p),this.getRegionDetail())}resourceInfoIdData(e){this.savedProposalService.getProposal({_id:e}).subscribe(e=>{200===e.status&&(e=e.data[0],this.resourceInfo=JSON.parse(e.estimationData),this.spinner.hide())},e=>{this.spinner.hide(),this.toastr.error(e.message,"Error!")})}ngOnInit(){this.globalService.getPageTitle(this.title),this.hourlyWiseConfig=this.jwtService.getConfig().resourcesCalculation,this.optionsResources.floor=this.hourlyWiseConfig.resources.min,this.optionsResources.ceil=this.hourlyWiseConfig.resources.max,this.optionsMonthly.floor=this.hourlyWiseConfig.timeFrameInMonths.min,this.optionsMonthly.ceil=this.hourlyWiseConfig.timeFrameInMonths.max}getManageServicesList(){this.manageService.getManageServices({status:1}).subscribe(e=>{this.spinner.show(),200===e.status&&(this.spinner.hide(),this.manageServicesList=e=e.data)},e=>{this.spinner.hide(),this.toastr.error(e.message,"Error!")})}getSubRegionsList(){this.subRegionsService.getSubRegionsList().subscribe(e=>{this.spinner.show(),200===e.status&&(this.spinner.hide(),this.subRegionsList=e=e.data,this.spinner.hide())},e=>{this.spinner.hide(),this.toastr.error(e.message,"Error!")})}getRegionDetail(e){if(e){const t=this.subRegionsList.find(t=>t._id===e);this.regionsService.getRegionsList({_id:t.regionId,status:1}).subscribe(e=>{this.spinner.show(),200===e.status&&(this.spinner.hide(),this.resourceInfo.region=(e=e.data).length?Object.assign({},...e):{}),this.calculation()},e=>{this.spinner.hide(),this.toastr.error(e.message,"Error!")})}else this.resourceInfo.region={},this.calculation()}calculation(e){e&&(this.resourceInfo.selectedService=this.manageServicesList.find(t=>e===t._id));let t=this.resourceInfo.resources*this.resourceInfo.months;this.resourceInfo.timeIndex=t;let o=this.resourceInfo.selectedService.monthlyPrice*this.resourceInfo.selectedService.expertise/10,s=o;t>59?s=.7*o:t>23?s=.8*o:t>10&&(s=.9*o);const i=s*this.resourceInfo.region.regionFactor*this.resourceInfo.currencies.currencyFactor,r=i-i*this.resourceInfo.discount/100;this.resourceInfo.finalPriceWithDiscount=(Math.round(100*r)/100).toFixed(2),this.resourceInfo.totalMonthlyCost=Math.round(r*this.resourceInfo.resources*100/100).toFixed(2),this.resourceInfo.totalProjectCost=r*this.resourceInfo.resources*this.resourceInfo.months,this.resourceInfo.validate=this.validateForm()}validateForm(){return!!(this.resourceInfo.regionId&&this.resourceInfo.region._id&&this.resourceInfo.selectedService&&this.resourceInfo.resources&&this.resourceInfo.totalMonthlyCost&&this.resourceInfo.totalProjectCost&&this.resourceInfo.months)}calculationModal(){this.alertService.clear(),this.saveCalculationModal.show()}closeModel(){this.saveCalculationModal.hide(),this.estimatorPdfModal.hide()}showCalculationInPdf(){let e=JSON.parse(JSON.stringify(this.resourceInfo));if(Object.keys(this.requiredValidation).filter(t=>!e[t]).length)return this.alertService.clear(),this.alertService.error("*Please Fill All Fields are mandatory."),this.spinner.hide(),!1;this.alertService.clear(),this.saveCalculationModal.hide(),this.estimatorPdfModal.show()}saveProposal(){this.spinner.show();let e=JSON.parse(JSON.stringify(this.resourceInfo)),t={projectName:e.projectName,prospectName:e.prospectName,type:e.type,tags:e.tags,expiryDate:e.expiryDate,status:e.status,estimationData:JSON.stringify(e)};delete t.prospectName,delete t.expiryDate,this.savedProposalService.saveProposal(t).subscribe(e=>{200===e.status&&(this.spinner.hide(),this.toastr.success(e.message,"Success!"),e=e.data)},e=>{this.spinner.hide(),this.toastr.error(e.message,"Error!")})}downloadAsPDF(){this.spinner.show();const e=document.getElementById("hourlyTemplate"),t=new r.ZP("p","mm","a4");t.html(e,{html2canvas:{scale:.198}}).then(()=>{t.save("download.pdf"),this.closeModel(),this.saveProposal(),this.router.navigate(["/saved-proposal"])})}}return e.\u0275fac=function(t){return new(t||e)(c.Y36(s.gz),c.Y36(s.F0),c.Y36(a.cC),c.Y36(a.sp),c.Y36(a.p9),c.Y36(a.EY),c.Y36(a.Tj),c.Y36(a.c9),c.Y36(u.t2),c.Y36(d._W),c.Y36(a.Uh))},e.\u0275cmp=c.Xpm({type:e,selectors:[["app-resources"]],viewQuery:function(e,t){if(1&e&&(c.Gf(I,5),c.Gf(y,5),c.Gf(T,5)),2&e){let e;c.iGM(e=c.CRH())&&(t.hourlyTemplate=e.first),c.iGM(e=c.CRH())&&(t.saveCalculationModal=e.first),c.iGM(e=c.CRH())&&(t.estimatorPdfModal=e.first)}},decls:94,vars:30,consts:[[1,"d-flex","flex-row"],[1,"col-12"],[1,"opacity-50"],[1,"container-fluid","bg-white","py-3","dataDisplaySection"],[1,"row","g-3","mb-3"],[1,"col-lg-6"],[1,"mb-3"],["for","countryId",1,"form-label"],[3,"ngClass"],[1,"fas","fa-star","fa-xs"],["id","countryId","name","countryId",1,"form-select",3,"ngModel","ngModelChange"],["value",""],[3,"ngValue",4,"ngFor","ngForOf"],["for","serviceId",1,"form-label"],["id","selectedService","name","selectedService",1,"form-select",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"ngModel","options","ngModelChange"],[1,"align-items-start","col-lg-6"],[3,"calculationData","callParentCalculation","calculationModal"],["bsModal","","tabindex","-1","role","dialog","aria-labelledby","myModalLabel","aria-hidden","true",1,"modal","fade",3,"config"],["saveCalculationModal","bs-modal"],["role","document",1,"modal-dialog","modal-dialog-centered","modal-dialog-scrollable"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"row","row-xs","align-items-center","mg-b-20"],["for","projectName",1,"form-label"],["type","text","id","projectName","placeholder","Type Here","name","projectName","characterOnly","",1,"form-control",3,"ngModel","ngModelChange"],["for","prospectName",1,"form-label"],["type","text","id","prospectName","placeholder","Type Here","name","prospectName",1,"form-control",3,"ngModel","ngModelChange"],["for","tags",1,"form-label"],["type","text","id","tags","placeholder","Type Tags Here","name","tags","characterOnly","",1,"form-control",3,"ngModel","ngModelChange"],[1,"row"],["for","expiryDate",1,"col-auto","col-form-label"],[1,"col-auto"],[1,"input-group"],["type","text","id","expiryDate","name","daterange","autocomplete","off","bsDatepicker","","placeholder","Select Date","onkeypress","return false",1,"form-control",3,"bsConfig","ngModel","minDate","maxDate","ngModelChange"],["dp","bsDatepicker"],[1,"input-group-text",3,"click"],[1,"icon-calendar"],[1,"modal-footer","border-top-0","justify-content-start"],["type","submit",1,"btn","btn-primary",3,"click"],["estimatorPdfModal","bs-modal"],["role","document",1,"modal-dialog","modal-dialog-centered","modal-dialog-scrollable","modal-xl"],[1,"modal-body",2,"overflow","auto","max-height","555px"],[3,"calculationData"],[1,"modal-footer","border-top-0","justify-content-center"],[3,"ngValue"],[3,"value"]],template:function(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"div",0),c.TgZ(1,"div",1),c.TgZ(2,"h4",2),c.TgZ(3,"h4"),c._uU(4,"Resources Wise Calculation"),c.qZA(),c.qZA(),c._UZ(5,"hr"),c.qZA(),c.qZA(),c.TgZ(6,"div",3),c.TgZ(7,"div",4),c.TgZ(8,"div",5),c.TgZ(9,"div",6),c.TgZ(10,"label",7),c._uU(11,"Country "),c.TgZ(12,"sup",8),c._UZ(13,"i",9),c.qZA(),c.qZA(),c.TgZ(14,"select",10),c.NdJ("ngModelChange",function(e){return t.resourceInfo.regionId=e})("ngModelChange",function(){return t.getRegionDetail(t.resourceInfo.regionId)}),c.TgZ(15,"option",11),c._uU(16,"Select Region"),c.qZA(),c.YNc(17,b,2,2,"option",12),c.qZA(),c.qZA(),c.TgZ(18,"div",6),c.TgZ(19,"label",13),c._uU(20,"Choose Service "),c.TgZ(21,"sup",8),c._UZ(22,"i",9),c.qZA(),c.qZA(),c.TgZ(23,"select",14),c.NdJ("ngModelChange",function(e){return t.resourceInfo.serviceId=e})("ngModelChange",function(e){return t.calculation(e)}),c.TgZ(24,"option",11),c._uU(25,"Select Service"),c.qZA(),c.YNc(26,x,2,2,"option",15),c.qZA(),c.qZA(),c.TgZ(27,"div",6),c.TgZ(28,"label",13),c._uU(29),c.qZA(),c.TgZ(30,"ngx-slider",16),c.NdJ("ngModelChange",function(e){return t.resourceInfo.resources=e})("ngModelChange",function(){return t.calculation()}),c.qZA(),c.qZA(),c.TgZ(31,"div",6),c.TgZ(32,"label",13),c._uU(33),c.qZA(),c.TgZ(34,"ngx-slider",16),c.NdJ("ngModelChange",function(e){return t.resourceInfo.months=e})("ngModelChange",function(){return t.calculation()}),c.qZA(),c.qZA(),c.qZA(),c.TgZ(35,"div",17),c.TgZ(36,"app-estimator-card",18),c.NdJ("callParentCalculation",function(){return t.calculation()})("calculationModal",function(){return t.calculationModal()}),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.TgZ(37,"div",19,20),c.TgZ(39,"div",21),c.TgZ(40,"div",22),c.TgZ(41,"div",23),c.TgZ(42,"h4",24),c._uU(43,"Save Calculation"),c.qZA(),c.TgZ(44,"button",25),c.NdJ("click",function(){return t.closeModel()}),c.TgZ(45,"span",26),c._uU(46,"\xd7"),c.qZA(),c.qZA(),c.qZA(),c.TgZ(47,"div",27),c.TgZ(48,"div",28),c.TgZ(49,"div",6),c.TgZ(50,"label",29),c._uU(51," Project Name "),c.TgZ(52,"sup",8),c._UZ(53,"i",9),c.qZA(),c.qZA(),c.TgZ(54,"input",30),c.NdJ("ngModelChange",function(e){return t.resourceInfo.projectName=e}),c.qZA(),c.qZA(),c.TgZ(55,"div",6),c.TgZ(56,"label",31),c._uU(57,"Prospect Name "),c.TgZ(58,"sup",8),c._UZ(59,"i",9),c.qZA(),c.qZA(),c.TgZ(60,"input",32),c.NdJ("ngModelChange",function(e){return t.resourceInfo.prospectName=e}),c.qZA(),c.qZA(),c.TgZ(61,"div",6),c.TgZ(62,"label",33),c._uU(63," Tags "),c.TgZ(64,"sup",8),c._UZ(65,"i",9),c.qZA(),c.qZA(),c.TgZ(66,"input",34),c.NdJ("ngModelChange",function(e){return t.resourceInfo.tags=e}),c.qZA(),c.qZA(),c.qZA(),c.TgZ(67,"div",35),c.TgZ(68,"label",36),c._uU(69,"Expiry Date "),c.TgZ(70,"sup",8),c._UZ(71,"i",9),c.qZA(),c.qZA(),c.TgZ(72,"div",37),c.TgZ(73,"div",38),c.TgZ(74,"input",39,40),c.NdJ("ngModelChange",function(e){return t.resourceInfo.expiryDate=e}),c.qZA(),c.TgZ(76,"span",41),c.NdJ("click",function(){return c.CHM(e),c.MAs(75).toggle()}),c._UZ(77,"i",42),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c._UZ(78,"app-alert"),c.TgZ(79,"div",43),c.TgZ(80,"button",44),c.NdJ("click",function(){return t.showCalculationInPdf()}),c._uU(81,"Enter "),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.TgZ(82,"div",19,45),c.TgZ(84,"div",46),c.TgZ(85,"div",22),c.TgZ(86,"div",47),c._UZ(87,"app-estimator-pdf",48),c.qZA(),c._UZ(88,"app-alert"),c.TgZ(89,"div",49),c.TgZ(90,"button",44),c.NdJ("click",function(){return t.downloadAsPDF()}),c._uU(91,"Save PDF "),c.qZA(),c.TgZ(92,"button",44),c.NdJ("click",function(){return t.closeModel()}),c._uU(93,"cancel "),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.qZA()}2&e&&(c.xp6(12),c.Q6J("ngClass",t.resourceInfo.regionId?"text-primary":"text-danger"),c.xp6(2),c.Q6J("ngModel",t.resourceInfo.regionId),c.xp6(3),c.Q6J("ngForOf",t.subRegionsList),c.xp6(4),c.Q6J("ngClass",t.resourceInfo.selectedService?"text-primary":"text-danger"),c.xp6(2),c.Q6J("ngModel",t.resourceInfo.serviceId),c.xp6(3),c.Q6J("ngForOf",t.manageServicesList),c.xp6(3),c.hij("Resources: ",t.resourceInfo.resources," "),c.xp6(1),c.Q6J("ngModel",t.resourceInfo.resources)("options",t.optionsResources),c.xp6(3),c.hij("Time Frame in Months : ",t.resourceInfo.months," "),c.xp6(1),c.Q6J("ngModel",t.resourceInfo.months)("options",t.optionsMonthly),c.xp6(2),c.Q6J("calculationData",t.resourceInfo),c.xp6(1),c.Q6J("config",c.DdM(27,A)),c.xp6(15),c.Q6J("ngClass",t.resourceInfo.projectName?"text-primary":"text-danger"),c.xp6(2),c.Q6J("ngModel",t.resourceInfo.projectName),c.xp6(4),c.Q6J("ngClass",t.resourceInfo.prospectName?"text-primary":"text-danger"),c.xp6(2),c.Q6J("ngModel",t.resourceInfo.prospectName),c.xp6(4),c.Q6J("ngClass",t.resourceInfo.tags?"text-primary":"text-danger"),c.xp6(2),c.Q6J("ngModel",t.resourceInfo.tags),c.xp6(4),c.Q6J("ngClass",t.resourceInfo.expiryDate?"text-primary":"text-danger"),c.xp6(4),c.Q6J("bsConfig",c.DdM(28,C))("ngModel",t.resourceInfo.expiryDate)("minDate",t.DateRange.minDate)("maxDate",t.DateRange.maxDate),c.xp6(8),c.Q6J("config",c.DdM(29,A)),c.xp6(5),c.Q6J("calculationData",t.resourceInfo))},directives:[g.mk,h.EJ,h.JJ,h.On,h.YN,h.Kr,g.sg,p.w5,f._,i.oB,h.Fj,m.y,Z.Y5,Z.Np,v.w,M.I],styles:[""]}),e})();const D=[{path:"",component:q,pathMatch:"full"},{path:":id",component:q,pathMatch:"full"}];let S=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=c.oAB({type:e}),e.\u0275inj=c.cJS({imports:[[s.Bz.forChild(D)],s.Bz]}),e})(),N=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=c.oAB({type:e}),e.\u0275inj=c.cJS({imports:[[a.eY,S]]}),e})()}}]);