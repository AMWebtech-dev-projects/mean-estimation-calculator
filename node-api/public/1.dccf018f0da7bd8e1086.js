(self.webpackChunkangular=self.webpackChunkangular||[]).push([[1],{7001:(t,e,i)=>{"use strict";i.r(e),i.d(e,{LoginModule:()=>b});var s=i(6090),n=i(793),o=i(9765),r=i(7771),a=i(5319),h=i(309),c=i(7971),l=i(8858);class u extends o.xQ{constructor(t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,i){super(),this.scheduler=i,this._events=[],this._infiniteTimeWindow=!1,this._bufferSize=t<1?1:t,this._windowTime=e<1?1:e,e===Number.POSITIVE_INFINITY?(this._infiniteTimeWindow=!0,this.next=this.nextInfiniteTimeWindow):this.next=this.nextTimeWindow}nextInfiniteTimeWindow(t){if(!this.isStopped){const e=this._events;e.push(t),e.length>this._bufferSize&&e.shift()}super.next(t)}nextTimeWindow(t){this.isStopped||(this._events.push(new g(this._getNow(),t)),this._trimBufferThenGetEvents()),super.next(t)}_subscribe(t){const e=this._infiniteTimeWindow,i=e?this._events:this._trimBufferThenGetEvents(),s=this.scheduler,n=i.length;let o;if(this.closed)throw new c.N;if(this.isStopped||this.hasError?o=a.w.EMPTY:(this.observers.push(t),o=new l.W(this,t)),s&&t.add(t=new h.ht(t,s)),e)for(let r=0;r<n&&!t.closed;r++)t.next(i[r]);else for(let r=0;r<n&&!t.closed;r++)t.next(i[r].value);return this.hasError?t.error(this.thrownError):this.isStopped&&t.complete(),o}_getNow(){return(this.scheduler||r.c).now()}_trimBufferThenGetEvents(){const t=this._getNow(),e=this._bufferSize,i=this._windowTime,s=this._events,n=s.length;let o=0;for(;o<n&&!(t-s[o].time<i);)o++;return n>e&&(o=Math.max(o,n-e)),o>0&&s.splice(0,o),s}}class g{constructor(t,e){this.time=t,this.value=e}}class d extends o.xQ{constructor(){super(...arguments),this.value=null,this.hasNext=!1,this.hasCompleted=!1}_subscribe(t){return this.hasError?(t.error(this.thrownError),a.w.EMPTY):this.hasCompleted&&this.hasNext?(t.next(this.value),t.complete(),a.w.EMPTY):super._subscribe(t)}next(t){this.hasCompleted||(this.value=t,this.hasNext=!0)}error(t){this.hasCompleted||super.error(t)}complete(){this.hasCompleted=!0,this.hasNext&&super.next(this.value),super.complete()}}var p=i(2057);class m{}let _=(()=>{class t extends class{constructor(){}loadScript(t,e,i,s=null){if("undefined"!=typeof document&&!document.getElementById(t)){let t=document.createElement("script");t.async=!0,t.src=e,t.onload=i,s||(s=document.head),s.appendChild(t)}}}{constructor(t,e={scope:"email"}){super(),this.clientId=t,this.initOptions=e}initialize(){return new Promise((e,i)=>{try{this.loadScript(t.PROVIDER_ID,"https://apis.google.com/js/platform.js",()=>{gapi.load("auth2",()=>{this.auth2=gapi.auth2.init(Object.assign(Object.assign({},this.initOptions),{client_id:this.clientId})),this.auth2.then(()=>{e()}).catch(t=>{i(t)})})})}catch(s){i(s)}})}getLoginStatus(e){const i=Object.assign(Object.assign({},this.initOptions),e);return new Promise((e,s)=>{if(this.auth2.isSignedIn.get()){let t=new m;const s=this.auth2.currentUser.get().getBasicProfile(),n=this.auth2.currentUser.get().getAuthResponse(!0);t.id=s.getId(),t.name=s.getName(),t.email=s.getEmail(),t.photoUrl=s.getImageUrl(),t.firstName=s.getGivenName(),t.lastName=s.getFamilyName(),t.response=n;const o=i=>{t.authToken=i.access_token,t.idToken=i.id_token,e(t)};i.refreshToken?this.auth2.currentUser.get().reloadAuthResponse().then(o):o(this.auth2.currentUser.get().getAuthResponse(!0))}else s(`No user is currently logged in with ${t.PROVIDER_ID}`)})}signIn(t){const e=Object.assign(Object.assign({},this.initOptions),t);return new Promise((i,s)=>{(e&&e.offline_access?this.auth2.grantOfflineAccess(t):this.auth2.signIn(t)).then(t=>{let e=new m;if(t&&t.code)e.authorizationCode=t.code;else{let t=this.auth2.currentUser.get().getBasicProfile(),i=this.auth2.currentUser.get().getAuthResponse(!0),s=i.access_token,n=i.id_token;e.id=t.getId(),e.name=t.getName(),e.email=t.getEmail(),e.photoUrl=t.getImageUrl(),e.firstName=t.getGivenName(),e.lastName=t.getFamilyName(),e.authToken=s,e.idToken=n,e.response=i}i(e)},t=>{s(t)}).catch(t=>{s(t)})})}signOut(t){return new Promise((e,i)=>{let s;s=t?this.auth2.disconnect():this.auth2.signOut(),s.then(t=>{t?i(t):e()}).catch(t=>{i(t)})})}}return t.PROVIDER_ID="GOOGLE",t})(),f=(()=>{class t{constructor(t){this.providers=new Map,this.autoLogin=!1,this._user=null,this._authState=new u(1),this.initialized=!1,this._initState=new d,t instanceof Promise?t.then(t=>{this.initialize(t)}):this.initialize(t)}get authState(){return this._authState.asObservable()}get initState(){return this._initState.asObservable()}initialize(t){this.autoLogin=void 0!==t.autoLogin&&t.autoLogin;const{onError:e=console.error}=t;t.providers.forEach(t=>{this.providers.set(t.id,t.provider)}),Promise.all(Array.from(this.providers.values()).map(t=>t.initialize())).then(()=>{if(this.autoLogin){const t=[];let e=!1;this.providers.forEach((i,s)=>{let n=i.getLoginStatus();t.push(n),n.then(t=>{t.provider=s,this._user=t,this._authState.next(t),e=!0}).catch(console.debug)}),Promise.all(t).catch(()=>{e||(this._user=null,this._authState.next(null))})}}).catch(t=>{e(t)}).finally(()=>{this.initialized=!0,this._initState.next(this.initialized),this._initState.complete()})}refreshAuthToken(e){return new Promise((i,s)=>{if(this.initialized)if(e!==_.PROVIDER_ID)s(t.ERR_NOT_SUPPORTED_FOR_REFRESH_TOKEN);else{const n=this.providers.get(e);n?n.getLoginStatus({refreshToken:!0}).then(t=>{t.provider=e,this._user=t,this._authState.next(t),i()}).catch(t=>{s(t)}):s(t.ERR_LOGIN_PROVIDER_NOT_FOUND)}else s(t.ERR_NOT_INITIALIZED)})}signIn(e,i){return new Promise((s,n)=>{if(this.initialized){let o=this.providers.get(e);o?o.signIn(i).then(t=>{t.provider=e,s(t),this._user=t,this._authState.next(t)}).catch(t=>{n(t)}):n(t.ERR_LOGIN_PROVIDER_NOT_FOUND)}else n(t.ERR_NOT_INITIALIZED)})}signOut(e=!1){return new Promise((i,s)=>{if(this.initialized)if(this._user){let n=this.providers.get(this._user.provider);n?n.signOut(e).then(()=>{i(),this._user=null,this._authState.next(null)}).catch(t=>{s(t)}):s(t.ERR_LOGIN_PROVIDER_NOT_FOUND)}else s(t.ERR_NOT_LOGGED_IN);else s(t.ERR_NOT_INITIALIZED)})}}return t.ERR_LOGIN_PROVIDER_NOT_FOUND="Login provider not found",t.ERR_NOT_LOGGED_IN="Not logged in",t.ERR_NOT_INITIALIZED="Login providers not ready yet. Are there errors on your console?",t.ERR_NOT_SUPPORTED_FOR_REFRESH_TOKEN="Chosen login provider is not supported for refreshing a token",t.\u0275fac=function(e){return new(e||t)(n.LFG("SocialAuthServiceConfig"))},t.\u0275prov=n.Yz7({token:t,factory:t.\u0275fac}),t})(),v=(()=>{class t{constructor(t){if(t)throw new Error("SocialLoginModule is already loaded. Import it in the AppModule only")}static initialize(e){return{ngModule:t,providers:[f,{provide:"SocialAuthServiceConfig",useValue:e}]}}}return t.\u0275fac=function(e){return new(e||t)(n.LFG(t,12))},t.\u0275mod=n.oAB({type:t}),t.\u0275inj=n.cJS({providers:[f],imports:[[p.ez]]}),t})();var O=i(6633),I=i(9866),T=i(9699);function E(t,e){if(1&t){const t=n.EpF();n.TgZ(0,"div",10),n.TgZ(1,"div",11),n._UZ(2,"img",12),n.TgZ(3,"h5",13),n._uU(4," Estimation Calculator, From AM Webtech Pvt. Ltd. "),n.qZA(),n.qZA(),n.TgZ(5,"div",3),n.TgZ(6,"div",14),n.TgZ(7,"button",15),n.NdJ("click",function(){return n.CHM(t),n.oxw().loginWithGoogle()}),n._UZ(8,"img",16),n.TgZ(9,"span"),n._uU(10,"CONTINUE WITH GOOGLE"),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA()}}function N(t,e){1&t&&(n.TgZ(0,"div",10),n.TgZ(1,"div",11),n.TgZ(2,"div",17),n._UZ(3,"img",18),n.qZA(),n.qZA(),n.qZA())}class w{constructor(){this.email="",this.userPhoto=""}}const S=[{path:"",component:(()=>{class t{constructor(t,e,i,s,n,o,r){this.router=t,this.jwtService=e,this.spinner=i,this.usersService=s,this.globalService=n,this.toastr=o,this.socialAuthService=r,this.title="Login | Estimation Calculator",this.login=new w,this.loadingLoader=!1}ngOnInit(){this.globalService.getPageTitle(this.title)}doLogin(){let t=Object.assign({},this.login);this.usersService.doSignIn(t).subscribe(e=>{if(this.loadingLoader=!0,200===e.status){let i=e.data,s=e.config;i.userPhoto=t.userPhoto,this.toastr.success(e.message,"Success"),this.jwtService.saveToken(i.authorization),this.jwtService.saveCurrentUser(JSON.stringify(i)),this.jwtService.getCurrentUser(),this.jwtService.saveConfig(JSON.stringify(s)),this.jwtService.getConfig(),this.globalService.sendActionChildToParent("Loggin"),setTimeout(()=>{this.router.navigate(["/dashboard"])},3e3)}else this.toastr.error(e.message,"Error"),this.loadingLoader=!1},t=>{this.loadingLoader=!1,this.spinner.hide(),this.toastr.error(t.message,"Error")})}loginWithGoogle(){console.log("ernter in function"),this.socialAuthService.signIn(_.PROVIDER_ID).then(t=>{console.log("resp in function",t),this.spinner.show(),t.authToken&&(this.login.email=t.email,this.login.userPhoto=t.photoUrl,this.spinner.hide(),this.doLogin())}).catch(t=>{console.log("err",JSON.stringify(t))})}}return t.\u0275fac=function(e){return new(e||t)(n.Y36(s.F0),n.Y36(O.Tj),n.Y36(I.t2),n.Y36(O.fz),n.Y36(O.Uh),n.Y36(T._W),n.Y36(f))},t.\u0275cmp=n.Xpm({type:t,selectors:[["app-login"]],decls:13,vars:2,consts:[[1,"app-body","app-login"],[1,"main","d-flex","align-items-center"],[1,"container"],[1,"row"],[1,"col-xl-4","col-lg-6","col-md-8","mx-auto"],[1,"card","p-4","mb-0","position-relative"],[1,"d-flex","custom-border"],[1,"secondary-bg"],[1,"primary-bg"],["class","card-body text-center",4,"ngIf"],[1,"card-body","text-center"],[1,"row","p-4"],["src","assets/img/brand/AMW_Logo.svg","alt","company-logo",1,"d-block","mx-auto",2,"width","12rem"],[1,"pt-3","login-heading"],[1,"col-12","d-flex","justify-content-center"],["type","button","id","login-btn",1,"btn","btn-primary","px-4","d-flex","align-items-center",3,"click"],["src","assets/img/brand/google-logo.png","alt","google-logo",1,"me-2","shadow","bg-light"],[1,"col-12","d-flex","justify-content-center","align-items-center"],["src","assets/img/brand/loader.gif","alt","loader",1,"d-block","mx-auto",2,"width","150px"]],template:function(t,e){1&t&&(n.TgZ(0,"div",0),n.TgZ(1,"main",1),n.TgZ(2,"div",2),n.TgZ(3,"div",3),n.TgZ(4,"div",4),n.TgZ(5,"div",5),n.TgZ(6,"div",6),n._UZ(7,"span",7),n._UZ(8,"span",8),n._UZ(9,"span",7),n._UZ(10,"span",8),n.qZA(),n.YNc(11,E,11,0,"div",9),n.YNc(12,N,4,0,"div",9),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA()),2&t&&(n.xp6(11),n.Q6J("ngIf",!e.loadingLoader),n.xp6(1),n.Q6J("ngIf",e.loadingLoader))},directives:[p.O5],styles:[".text-secondary[_ngcontent-%COMP%]{color:#d53a46!important}.app-login[_ngcontent-%COMP%]   .main[_ngcontent-%COMP%]{height:100vh}.app-login[_ngcontent-%COMP%]   .main[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{min-height:295px}.app-login[_ngcontent-%COMP%]   .main[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .login-heading[_ngcontent-%COMP%]{text-align:center;color:grey;font-family:Montserrat}"]}),t})(),pathMatch:"full"}];let R=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=n.oAB({type:t}),t.\u0275inj=n.cJS({imports:[[s.Bz.forChild(S)],s.Bz]}),t})(),b=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=n.oAB({type:t}),t.\u0275inj=n.cJS({providers:[{provide:"SocialAuthServiceConfig",useValue:{autoLogin:!1,providers:[{id:_.PROVIDER_ID,provider:new _("1051803384347-91967jipju1ume5ul4dcr5g84bfaja56.apps.googleusercontent.com")}]}}],imports:[[O.eY,R,v]]}),t})()}}]);