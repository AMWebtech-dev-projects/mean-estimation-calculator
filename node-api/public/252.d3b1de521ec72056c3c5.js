(self.webpackChunkangular=self.webpackChunkangular||[]).push([[252],{8252:(e,t,i)=>{"use strict";i.r(t),i.d(t,{UserServiceModuleModule:()=>_});var r=i(6090),s=i(5551),o=i(8525),a=i(6633),n=i(2340);class l extends a.HA{constructor(){super(...arguments),this.userCount=0,this.type=n.N.calculationType.module,this.clone={userType:"",serviceModulesList:[]},this.userwise=[],this.totalModuleDays=0,this.approxDayCal=0,this.finalPriceWithDiscount=0}}var c=i(793),u=i(9866),d=i(9699),g=i(2057),h=i(3738),p=i(5484),v=i(337),Z=i(643),m=i(6355),M=i(2443),f=i(3358);const S=["hourlyTemplate"],T=["saveCalculationModal"],x=["estimatorPdfModal"];function A(e,t){if(1&e&&(c.TgZ(0,"option",18),c._uU(1),c.qZA()),2&e){const e=t.$implicit;c.Q6J("ngValue",e._id),c.xp6(1),c.hij(" ",e.countryName," ")}}function b(e,t){if(1&e&&(c.TgZ(0,"option",53),c._uU(1),c.qZA()),2&e){const e=t.$implicit;c.Q6J("value",e._id),c.xp6(1),c.hij(" ",e.serviceName," ")}}function y(e,t){if(1&e&&(c.TgZ(0,"option",18),c._uU(1),c.qZA()),2&e){const e=t.$implicit;c.Q6J("ngValue",e),c.xp6(1),c.hij(" ",e," ")}}function q(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"tr"),c.TgZ(1,"td"),c.TgZ(2,"input",65),c.NdJ("ngModelChange",function(t){return c.CHM(e).$implicit.isSelected=t})("ngModelChange",function(){return c.CHM(e),c.oxw(2).calculation()}),c.qZA(),c.qZA(),c.TgZ(3,"td",66),c._uU(4),c.qZA(),c.TgZ(5,"td"),c.TgZ(6,"input",67),c.NdJ("ngModelChange",function(t){return c.CHM(e).$implicit.unit=t})("ngModelChange",function(){return c.CHM(e),c.oxw(2).calculation()}),c.qZA(),c.qZA(),c.qZA()}if(2&e){const e=t.$implicit,i=t.index,r=c.oxw().index;c.xp6(2),c.hYB("id","check_",r,"_",i,""),c.Q6J("ngModel",e.isSelected),c.xp6(2),c.hij(" ",e.serviceModule," "),c.xp6(2),c.hYB("id","unit_",r,"_",i,""),c.Q6J("ngModel",e.unit)}}function C(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"div",6),c.TgZ(1,"div",54),c.TgZ(2,"div",55),c.TgZ(3,"div",38),c.TgZ(4,"strong",56),c._uU(5),c.qZA(),c.TgZ(6,"div",57),c.TgZ(7,"input",58),c.NdJ("ngModelChange",function(t){return c.CHM(e).$implicit.userType=t})("ngModelChange",function(){return c.CHM(e),c.oxw().calculation()}),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.TgZ(8,"div"),c.TgZ(9,"table",59),c.TgZ(10,"thead",60),c.TgZ(11,"tr",61),c.TgZ(12,"th",62),c._uU(13,"#"),c.qZA(),c.TgZ(14,"th",63),c._uU(15,"Service Module Name"),c.qZA(),c.TgZ(16,"th",62),c._uU(17,"Unit"),c.qZA(),c.qZA(),c.qZA(),c.TgZ(18,"tbody"),c.YNc(19,q,7,7,"tr",64),c.qZA(),c.qZA(),c.qZA(),c.qZA()}if(2&e){const e=t.$implicit,i=t.index;c.xp6(5),c.hij("User Type: ",i+1," "),c.xp6(2),c.MGl("name","user_",i,""),c.MGl("id","user_",i,""),c.Q6J("ngModel",e.userType),c.xp6(12),c.Q6J("ngForOf",e.serviceModulesList)}}const D=function(){return{backdrop:"static",keyboard:!1,animated:!0}},J=function(){return{isAnimated:!0,dateInputFormat:"DD/MM/YYYY",showWeekNumbers:!1,adaptivePosition:!0}},N=[{path:"",component:(()=>{class e{constructor(e,t,i,r,o,n,c,u,d,g,h,p){this.activatedRoute=e,this.router=t,this.savedProposalService=i,this.manageService=r,this.subRegionsService=o,this.regionsService=n,this.serviceModulesService=c,this.jwtService=u,this.alertService=d,this.spinner=g,this.toastr=h,this.globalService=p,this.title="Service ModulesWise Calculation | Estimation Calculator",this.userServiceModule=new l,this.manageServicesList=[],this.subRegionsList=[],this.servicePackagesList=[],this.usersCount=[],this.requiredValidation=new a.NZ,this.saveCalculationModal=s.oB,this.estimatorPdfModal=s.oB,this.DateRange={minDate:new Date,maxDate:new Date},this.DateRange.minDate.setDate(this.DateRange.minDate.getDate()),this.DateRange.maxDate.setDate(this.DateRange.minDate.getDate()+20),this.getManageServicesList(),this.getSubRegionsList(),this.getServiceModulesList();let v=this.activatedRoute.snapshot.params.id;v&&(this.userServiceModuleIdData(v),this.getRegionDetail())}ngOnInit(){this.globalService.getPageTitle(this.title),this.usersCount=this.jwtService.getConfig().usersCount}userServiceModuleIdData(e){this.savedProposalService.getProposal({_id:e}).subscribe(e=>{200===e.status&&(e=e.data[0],this.userServiceModule=JSON.parse(e.estimationData),this.spinner.hide())},e=>{this.spinner.hide(),this.toastr.error(e.message,"Error!")})}getManageServicesList(){this.manageService.getManageServices({status:1}).subscribe(e=>{this.spinner.show(),200===e.status&&(this.spinner.hide(),this.manageServicesList=e=e.data)},e=>{this.spinner.hide(),this.toastr.error(e.message,"Error!")})}getSubRegionsList(){this.subRegionsService.getSubRegionsList().subscribe(e=>{this.spinner.show(),200===e.status&&(this.spinner.hide(),this.subRegionsList=e=e.data,this.spinner.hide())},e=>{this.spinner.hide(),this.toastr.error(e.message,"Error!")})}getRegionDetail(e){if(e){const t=this.subRegionsList.find(t=>t._id===e);this.regionsService.getRegionsList({_id:t.regionId,status:1}).subscribe(e=>{this.spinner.show(),200===e.status&&(this.spinner.hide(),this.userServiceModule.region=(e=e.data).length?Object.assign({},...e):{}),this.calculation()},e=>{this.spinner.hide(),this.toastr.error(e.message,"Error!")})}else this.userServiceModule.region={},this.calculation()}getServiceModulesList(){this.serviceModulesService.getServiceModules().subscribe(e=>{this.spinner.show(),200===e.status&&(this.spinner.hide(),(e=e.data).length?(e.map(e=>{e.isSelected=!1,e.unit=1}),this.userServiceModule.clone.serviceModulesList=e):(this.userServiceModule.clone.serviceModulesList=[],this.toastr.warning("There are no modules of this service.","Warning!")))},e=>{this.spinner.hide(),this.toastr.error(e.message,"Error!")})}userwiseCollection(){if(this.userServiceModule.userCount){this.userServiceModule.userwise=[];for(let e=0;e<this.userServiceModule.userCount;e++)this.userServiceModule.userwise.push(JSON.parse(JSON.stringify(this.userServiceModule.clone)));this.calculation()}else this.userServiceModule.userwise=[],this.calculation()}filterPackagesByService(e){e?(this.userServiceModule.selectedService=this.manageServicesList.find(t=>e===t._id),this.calculation()):(this.calculation(),this.toastr.warning("Please select any service.","Warning!"))}calculation(e){e&&(this.userServiceModule.selectedService=this.manageServicesList.find(t=>e===t._id));let t=0;this.userServiceModule.userwise.map(e=>{e.userType&&e.serviceModulesList.map(e=>{e.unit&&e.isSelected&&(t+=Number(e.timeRequired*e.unit))})}),this.userServiceModule.totalModuleDays=t;let i=this.jwtService.getConfig().approx_Days.find(e=>e.greaterThan<=t&&e.lessThan>=t);this.userServiceModule.approxDayCal=Math.round(t/i.divideValDays);let r=t*this.userServiceModule.selectedService.hourlyPrice*this.userServiceModule.currencies.currencyFactor*this.userServiceModule.region.regionFactor;this.userServiceModule.finalPriceWithDiscount=(Math.round(100*(r-r*this.userServiceModule.discount/100))/100).toFixed(2),this.userServiceModule.validate=this.validateForm()}validateForm(){return!!(this.userServiceModule.regionId&&this.userServiceModule.totalModuleDays&&this.userServiceModule.region._id&&this.userServiceModule.approxDayCal&&this.userServiceModule.serviceId&&this.userServiceModule.finalPriceWithDiscount)}calculationModal(){this.alertService.clear(),this.saveCalculationModal.show()}closeModel(){this.saveCalculationModal.hide(),this.estimatorPdfModal.hide()}showCalculationInPdf(){let e=JSON.parse(JSON.stringify(this.userServiceModule));if(Object.keys(this.requiredValidation).filter(t=>!e[t]).length)return this.alertService.clear(),this.alertService.error("*Please Fill All Fields are mandatory."),this.spinner.hide(),!1;this.alertService.clear(),this.saveCalculationModal.hide(),this.estimatorPdfModal.show()}downloadAsPDF(){this.spinner.show();const e=document.getElementById("hourlyTemplate"),t=new o.ZP("p","mm","a4");t.html(e,{html2canvas:{scale:.198}}).then(()=>{t.save("download.pdf"),this.closeModel(),this.saveProposal(),this.router.navigate(["/saved-proposal"])})}saveProposal(){this.spinner.show();let e=JSON.parse(JSON.stringify(this.userServiceModule)),t={projectName:e.projectName,prospectName:e.prospectName,type:e.type,tags:e.tags,expiryDate:e.expiryDate,status:e.status,estimationData:JSON.stringify(e)};delete t.prospectName,delete t.expiryDate,this.savedProposalService.saveProposal(t).subscribe(e=>{200===e.status&&(this.spinner.hide(),this.toastr.success(e.message,"Success!"),e=e.data)},e=>{this.spinner.hide(),this.toastr.error(e.message,"Error!")})}}return e.\u0275fac=function(t){return new(t||e)(c.Y36(r.gz),c.Y36(r.F0),c.Y36(a.cC),c.Y36(a.sp),c.Y36(a.p9),c.Y36(a.EY),c.Y36(a.V4),c.Y36(a.Tj),c.Y36(a.c9),c.Y36(u.t2),c.Y36(d._W),c.Y36(a.Uh))},e.\u0275cmp=c.Xpm({type:e,selectors:[["app-user-service-module"]],viewQuery:function(e,t){if(1&e&&(c.Gf(S,5),c.Gf(T,5),c.Gf(x,5)),2&e){let e;c.iGM(e=c.CRH())&&(t.hourlyTemplate=e.first),c.iGM(e=c.CRH())&&(t.saveCalculationModal=e.first),c.iGM(e=c.CRH())&&(t.estimatorPdfModal=e.first)}},decls:96,vars:29,consts:[[1,"d-flex","flex-row"],[1,"col-12"],[1,"opacity-50"],[1,"container-fluid","bg-white","py-3","dataDisplaySection"],[1,"row","g-3","mb-3"],[1,"col-lg-6"],[1,"mb-3"],["for","countryId",1,"form-label"],[3,"ngClass"],[1,"fas","fa-star","fa-xs"],["id","countryId","name","countryId",1,"form-select",3,"ngModel","ngModelChange"],["value",""],[3,"ngValue",4,"ngFor","ngForOf"],["for","serviceId",1,"form-label"],["id","serviceId","name","serviceId",1,"form-select",3,"ngModel","ngModelChange","change"],[3,"value",4,"ngFor","ngForOf"],["for","userCount",1,"form-label"],["id","userCount","name","userCount",1,"form-select",3,"ngModel","ngModelChange"],[3,"ngValue"],["class","mb-3",4,"ngFor","ngForOf"],[1,"align-items-start","col-lg-6"],[3,"calculationData","callParentCalculation","calculationModal"],["bsModal","","tabindex","-1","role","dialog","aria-labelledby","myModalLabel","aria-hidden","true",1,"modal","fade",3,"config"],["saveCalculationModal","bs-modal"],["role","document",1,"modal-dialog","modal-dialog-centered","modal-dialog-scrollable"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"row","row-xs","align-items-center","mg-b-20"],["for","projectName",1,"form-label"],["type","text","id","projectName","placeholder","Type Here","name","projectName","characterOnly","",1,"form-control",3,"ngModel","ngModelChange"],["for","prospectName",1,"form-label"],["type","text","id","prospectName","placeholder","Type Here","name","prospectName",1,"form-control",3,"ngModel","ngModelChange"],["for","tags",1,"form-label"],["type","text","id","tags","placeholder","Type Tags Here","name","tags","characterOnly","",1,"form-control",3,"ngModel","ngModelChange"],[1,"row"],["for","expiryDate",1,"col-auto","col-form-label"],[1,"col-auto"],[1,"input-group"],["type","text","id","expiryDate","name","daterange","autocomplete","off","bsDatepicker","","placeholder","Select Date","onkeypress","return false",1,"form-control",3,"bsConfig","ngModel","minDate","maxDate","ngModelChange"],["dp","bsDatepicker"],[1,"input-group-text",3,"click"],[1,"icon-calendar"],[1,"modal-footer","border-top-0","justify-content-start"],["type","submit",1,"btn","btn-primary",3,"click"],["estimatorPdfModal","bs-modal"],["role","document",1,"modal-dialog","modal-dialog-centered","modal-dialog-scrollable","modal-xl"],[1,"modal-body",2,"overflow","auto","max-height","555px"],[3,"calculationData"],[1,"modal-footer","border-top-0","justify-content-center"],[3,"value"],[1,"card"],[1,"card-body"],[1,"col-3","form-label","pt-2"],[1,"col-9"],["type","text","placeholder","Please enter user",1,"form-control",3,"name","id","ngModel","ngModelChange"],[1,"table","table-bordered","table-hover","align-middle","table-borderless"],[1,"bg-primary","text-white"],[1,"text-nowrap","bg-primary","text-white"],["scope","col",1,"text-white"],["scope","col","colspan","4",1,"text-white"],[4,"ngFor","ngForOf"],["type","checkbox",1,"form-check-input",3,"id","ngModel","ngModelChange"],["colspan","4"],["type","text","placeholder","1","maxlength","2","numbersOnly","",1,"form-control",3,"id","ngModel","ngModelChange"]],template:function(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"div",0),c.TgZ(1,"div",1),c.TgZ(2,"h4",2),c.TgZ(3,"h4"),c._uU(4,"Service Modules Wise Calculation"),c.qZA(),c.qZA(),c._UZ(5,"hr"),c.qZA(),c.qZA(),c.TgZ(6,"div",3),c.TgZ(7,"div",4),c.TgZ(8,"div",5),c.TgZ(9,"div",6),c.TgZ(10,"label",7),c._uU(11,"Country "),c.TgZ(12,"sup",8),c._UZ(13,"i",9),c.qZA(),c.qZA(),c.TgZ(14,"select",10),c.NdJ("ngModelChange",function(e){return t.userServiceModule.regionId=e})("ngModelChange",function(){return t.getRegionDetail(t.userServiceModule.regionId)}),c.TgZ(15,"option",11),c._uU(16,"Select Region"),c.qZA(),c.YNc(17,A,2,2,"option",12),c.qZA(),c.qZA(),c.TgZ(18,"div",6),c.TgZ(19,"label",13),c._uU(20,"Choose Service "),c.TgZ(21,"sup",8),c._UZ(22,"i",9),c.qZA(),c.qZA(),c.TgZ(23,"select",14),c.NdJ("ngModelChange",function(e){return t.userServiceModule.serviceId=e})("change",function(){return t.filterPackagesByService(t.userServiceModule.serviceId)}),c.TgZ(24,"option",11),c._uU(25,"Select Service"),c.qZA(),c.YNc(26,b,2,2,"option",15),c.qZA(),c.qZA(),c.TgZ(27,"div",6),c.TgZ(28,"label",16),c._uU(29,"Users "),c.TgZ(30,"sup",8),c._UZ(31,"i",9),c.qZA(),c.qZA(),c.TgZ(32,"select",17),c.NdJ("ngModelChange",function(e){return t.userServiceModule.userCount=e})("ngModelChange",function(){return t.userwiseCollection()}),c.TgZ(33,"option",18),c._uU(34,"Select"),c.qZA(),c.YNc(35,y,2,2,"option",12),c.qZA(),c.qZA(),c.YNc(36,C,20,5,"div",19),c.qZA(),c.TgZ(37,"div",20),c.TgZ(38,"app-estimator-card",21),c.NdJ("callParentCalculation",function(){return t.calculation()})("calculationModal",function(){return t.calculationModal()}),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.TgZ(39,"div",22,23),c.TgZ(41,"div",24),c.TgZ(42,"div",25),c.TgZ(43,"div",26),c.TgZ(44,"h4",27),c._uU(45,"Save Calculation"),c.qZA(),c.TgZ(46,"button",28),c.NdJ("click",function(){return t.closeModel()}),c.TgZ(47,"span",29),c._uU(48,"\xd7"),c.qZA(),c.qZA(),c.qZA(),c.TgZ(49,"div",30),c.TgZ(50,"div",31),c.TgZ(51,"div",6),c.TgZ(52,"label",32),c._uU(53," Project Name "),c.TgZ(54,"sup",8),c._UZ(55,"i",9),c.qZA(),c.qZA(),c.TgZ(56,"input",33),c.NdJ("ngModelChange",function(e){return t.userServiceModule.projectName=e}),c.qZA(),c.qZA(),c.TgZ(57,"div",6),c.TgZ(58,"label",34),c._uU(59,"Prospect Name "),c.TgZ(60,"sup",8),c._UZ(61,"i",9),c.qZA(),c.qZA(),c.TgZ(62,"input",35),c.NdJ("ngModelChange",function(e){return t.userServiceModule.prospectName=e}),c.qZA(),c.qZA(),c.TgZ(63,"div",6),c.TgZ(64,"label",36),c._uU(65," Tags "),c.TgZ(66,"sup",8),c._UZ(67,"i",9),c.qZA(),c.qZA(),c.TgZ(68,"input",37),c.NdJ("ngModelChange",function(e){return t.userServiceModule.tags=e}),c.qZA(),c.qZA(),c.qZA(),c.TgZ(69,"div",38),c.TgZ(70,"label",39),c._uU(71,"Expiry Date "),c.TgZ(72,"sup",8),c._UZ(73,"i",9),c.qZA(),c.qZA(),c.TgZ(74,"div",40),c.TgZ(75,"div",41),c.TgZ(76,"input",42,43),c.NdJ("ngModelChange",function(e){return t.userServiceModule.expiryDate=e}),c.qZA(),c.TgZ(78,"span",44),c.NdJ("click",function(){return c.CHM(e),c.MAs(77).toggle()}),c._UZ(79,"i",45),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c._UZ(80,"app-alert"),c.TgZ(81,"div",46),c.TgZ(82,"button",47),c.NdJ("click",function(){return t.showCalculationInPdf()}),c._uU(83,"Enter "),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.TgZ(84,"div",22,48),c.TgZ(86,"div",49),c.TgZ(87,"div",25),c.TgZ(88,"div",50),c._UZ(89,"app-estimator-pdf",51),c.qZA(),c._UZ(90,"app-alert"),c.TgZ(91,"div",52),c.TgZ(92,"button",47),c.NdJ("click",function(){return t.downloadAsPDF()}),c._uU(93,"Save PDF "),c.qZA(),c.TgZ(94,"button",47),c.NdJ("click",function(){return t.closeModel()}),c._uU(95,"cancel "),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.qZA()}2&e&&(c.xp6(12),c.Q6J("ngClass",t.userServiceModule.regionId?"text-primary":"text-danger"),c.xp6(2),c.Q6J("ngModel",t.userServiceModule.regionId),c.xp6(3),c.Q6J("ngForOf",t.subRegionsList),c.xp6(4),c.Q6J("ngClass",t.userServiceModule.serviceId?"text-primary":"text-danger"),c.xp6(2),c.Q6J("ngModel",t.userServiceModule.serviceId),c.xp6(3),c.Q6J("ngForOf",t.manageServicesList),c.xp6(4),c.Q6J("ngClass",t.userServiceModule.userCount?"text-primary":"text-danger"),c.xp6(2),c.Q6J("ngModel",t.userServiceModule.userCount),c.xp6(1),c.Q6J("ngValue",0),c.xp6(2),c.Q6J("ngForOf",t.usersCount),c.xp6(1),c.Q6J("ngForOf",t.userServiceModule.userwise),c.xp6(2),c.Q6J("calculationData",t.userServiceModule),c.xp6(1),c.Q6J("config",c.DdM(26,D)),c.xp6(15),c.Q6J("ngClass",t.userServiceModule.projectName?"text-primary":"text-danger"),c.xp6(2),c.Q6J("ngModel",t.userServiceModule.projectName),c.xp6(4),c.Q6J("ngClass",t.userServiceModule.prospectName?"text-primary":"text-danger"),c.xp6(2),c.Q6J("ngModel",t.userServiceModule.prospectName),c.xp6(4),c.Q6J("ngClass",t.userServiceModule.tags?"text-primary":"text-danger"),c.xp6(2),c.Q6J("ngModel",t.userServiceModule.tags),c.xp6(4),c.Q6J("ngClass",t.userServiceModule.expiryDate?"text-primary":"text-danger"),c.xp6(4),c.Q6J("bsConfig",c.DdM(27,J))("ngModel",t.userServiceModule.expiryDate)("minDate",t.DateRange.minDate)("maxDate",t.DateRange.maxDate),c.xp6(8),c.Q6J("config",c.DdM(28,D)),c.xp6(5),c.Q6J("calculationData",t.userServiceModule))},directives:[g.mk,h.EJ,h.JJ,h.On,h.YN,h.Kr,g.sg,p._,s.oB,h.Fj,v.y,Z.Y5,Z.Np,m.w,M.I,h.Wl,h.nD,f.Y],styles:[""]}),e})(),pathMatch:"full"}];let w=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=c.oAB({type:e}),e.\u0275inj=c.cJS({imports:[[r.Bz.forChild(N)],r.Bz]}),e})(),_=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=c.oAB({type:e}),e.\u0275inj=c.cJS({imports:[[a.eY,w]]}),e})()}}]);